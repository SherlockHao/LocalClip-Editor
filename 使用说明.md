# LocalClip Editor 使用说明

## 🚀 快速开始

### 方式一：双击启动（推荐）

1. **启动服务**
   - 双击 `启动 LocalClip Editor.vbs`
   - 等待 10-15 秒
   - 浏览器会自动打开任务看板

2. **停止服务**
   - 双击 `停止 LocalClip Editor.vbs`
   - 或直接关闭两个命令行窗口

### 方式二：命令行启动

1. **启动服务**
   ```bash
   start_all.bat
   ```

2. **停止服务**
   ```bash
   stop_all.bat
   ```

---

## 📋 服务地址

启动成功后，可以访问以下地址：

- **任务看板**: http://localhost:5173/dashboard
- **后端 API**: http://localhost:8080
- **API 文档**: http://localhost:8080/docs

---

## 💡 使用流程

### 1. 创建任务

1. 访问任务看板
2. 点击右上角"创建新任务"按钮
3. 上传视频文件（必填）
4. 上传字幕文件（可选，SRT 格式）
5. 点击"创建任务"

### 2. 进入编辑器

1. 在任务看板中点击任务卡片
2. 系统自动加载视频和字幕
3. 左侧显示各语言处理进度
4. 顶部显示总体进度（可展开/收起）

### 3. 处理流程

#### 步骤 1: 说话人识别
- 点击"说话人识别"按钮
- 等待处理完成（进度条实时更新）
- 识别不同的说话人

#### 步骤 2: 翻译字幕
- 选择目标语言
- 点击"翻译"按钮
- 等待翻译完成
- 支持 7 种语言：英语、韩语、日语、法语、德语、西班牙语、印尼语

#### 步骤 3: 语音克隆
- 为每个说话人选择音色
- 点击"语音克隆"按钮
- 等待克隆完成

#### 步骤 4: 导出视频
- 点击"导出"按钮
- 等待视频生成
- 下载最终视频

---

## 🔧 故障排查

### 启动失败

**问题**: 双击 VBS 文件无反应

**解决**:
1. 检查是否安装了 Python 3.8+
2. 检查是否安装了 Node.js
3. 右键点击 `start_all.bat` → 以管理员身份运行

---

### 后端启动失败

**问题**: 后端窗口闪退或报错

**解决**:
1. 检查 Python 虚拟环境是否正确创建
   ```bash
   cd backend
   python -m venv venv
   venv\Scripts\activate
   pip install -r requirements.txt
   ```

2. 检查端口 8080 是否被占用
   ```bash
   netstat -ano | findstr :8080
   ```

3. 手动启动后端查看详细错误
   ```bash
   cd backend
   venv\Scripts\activate
   python main.py
   ```

---

### 前端启动失败

**问题**: 前端窗口闪退或报错

**解决**:
1. 检查 Node 模块是否安装
   ```bash
   cd frontend
   npm install
   ```

2. 检查端口 5173 是否被占用
   ```bash
   netstat -ano | findstr :5173
   ```

3. 手动启动前端查看详细错误
   ```bash
   cd frontend
   npm run dev
   ```

---

### 翻译失败

**问题**: 点击翻译后进度条不动或报错

**解决**:
1. 检查是否已完成说话人识别
2. 检查 Ollama 是否正在运行
3. 检查 qwen2.5:32b 模型是否已下载
   ```bash
   ollama list
   ```
4. 查看后端日志窗口的错误信息

---

### 语音克隆失败

**问题**: 语音克隆无进度或失败

**解决**:
1. 检查是否已完成翻译
2. 检查 Fish-Speech 服务是否运行
3. 检查音色文件是否存在
4. 查看后端日志

---

## 📁 文件结构

```
LocalClip-Editor/
├── 启动 LocalClip Editor.vbs    ← 双击启动（推荐）
├── 停止 LocalClip Editor.vbs    ← 双击停止
├── start_all.bat                ← 启动脚本（BAT）
├── stop_all.bat                 ← 停止脚本（BAT）
├── 使用说明.md                  ← 本文档
│
├── backend/                     ← 后端代码
│   ├── main.py                  ← 主程序
│   ├── translation_service.py   ← 翻译服务
│   ├── voice_cloning_service.py ← 语音克隆服务
│   └── routers/
│       ├── tasks.py             ← 任务 API
│       └── processing.py        ← 处理 API
│
├── frontend/                    ← 前端代码
│   └── src/
│       ├── pages/
│       │   ├── TaskDashboard.tsx    ← 任务看板
│       │   └── TaskEditorOld.tsx    ← 编辑器
│       └── components/
│           ├── TaskProgressBar.tsx  ← 顶部进度条
│           └── LanguageProgressSidebar.tsx  ← 语言进度
│
└── uploads/                     ← 任务文件存储
    └── {task_id}/
        ├── input/               ← 输入视频
        ├── processed/           ← 处理文件
        └── outputs/             ← 输出文件
            └── {language}/
                └── final_video.mp4
```

---

## 📊 任务状态说明

### 任务状态

- **pending** (待处理) - 任务已创建，尚未开始
- **processing** (处理中) - 任务正在处理
- **completed** (已完成) - 任务处理完成
- **failed** (失败) - 任务处理失败

### 语言处理阶段

每种语言有 4 个处理阶段：

1. **说话人识别** (speaker_diarization)
   - 识别视频中的不同说话人
   - 为每个字幕段落分配说话人 ID

2. **翻译** (translation)
   - 将字幕翻译成目标语言
   - 包含质量检查和优化

3. **语音克隆** (voice_cloning)
   - 使用 TTS 克隆每个说话人的声音
   - 生成目标语言的语音

4. **导出** (export)
   - 拼接克隆的音频
   - 合并视频和音频
   - 生成最终视频

---

## 🎯 快捷键

- **空格键**: 播放/暂停视频
- **←/→**: 快进/快退 5 秒
- **Ctrl + S**: 保存字幕编辑

---

## 📞 技术支持

如遇到问题，请：

1. 查看后端窗口的日志输出
2. 查看浏览器控制台（F12）的错误信息
3. 检查 `backend/backend_upload_test.log` 日志文件
4. 参考项目文档：
   - [PHASE4_FINAL_REPORT.md](PHASE4_FINAL_REPORT.md)
   - [TASK_WORKFLOW_UPDATE.md](TASK_WORKFLOW_UPDATE.md)

---

## 🎉 开始使用

现在，双击 `启动 LocalClip Editor.vbs` 开始使用吧！

**祝您使用愉快！** 🚀
