# Phase 3 端到端测试指南

## 测试准备

### 1. 启动后端
```bash
cd backend
python -m uvicorn main:app --host 0.0.0.0 --port 8080
```

### 2. 启动前端
```bash
cd frontend
npm run dev
```

### 3. 打开浏览器
访问: http://localhost:5173

---

## 测试场景

### 场景 1: 任务看板基础功能
1. **访问首页**
   - 自动重定向到 `/dashboard`
   - 显示"任务看板"页面
   - 显示"上传新视频"按钮

2. **空状态显示**
   - 如果没有任务，显示"暂无任务"提示
   - 显示视频图标占位

### 场景 2: 创建新任务
1. **上传视频**
   - 点击"上传新视频"按钮
   - 选择视频文件（建议 < 50MB）
   - 观察上传进度提示

2. **任务创建成功**
   - 自动跳转到任务编辑器页面
   - URL 变为 `/tasks/{task_id}`
   - 显示现有的编辑器界面

3. **返回看板**
   - 浏览器后退或访问 `/dashboard`
   - 看板应该显示新创建的任务卡片

### 场景 3: 任务卡片显示
1. **卡片信息**
   - ✅ 视频文件名
   - ✅ 创建时间
   - ✅ 任务状态（待处理/处理中/已完成/失败）

2. **语言进度条**
   - 显示 7 种语言（英语、韩语、日语、法语、德语、西语、印尼语）
   - 每种语言显示进度条（0-100%）
   - 颜色指示状态：
     - 绿色 = 已完成
     - 蓝色 = 处理中
     - 红色 = 失败
     - 灰色 = 未开始

### 场景 4: 任务操作
1. **打开任务**
   - 点击任务卡片或"打开"按钮
   - 跳转到编辑器页面 `/tasks/{task_id}`
   - 编辑器正常显示

2. **删除任务**
   - 点击删除按钮（垃圾桶图标）
   - 确认删除提示
   - 任务从列表中移除
   - 后端文件被删除

### 场景 5: WebSocket 实时进度（如果有任务处理）
1. **查看实时更新**
   - 在任务编辑器中触发处理（说话人识别/翻译/语音克隆）
   - 返回任务看板
   - 观察进度条实时更新

2. **连接状态**
   - WebSocket 连接成功：看板实时更新
   - WebSocket 断开：自动降级到轮询（每 2 秒）
   - 浏览器控制台显示连接状态

### 场景 6: 路由导航
1. **URL 导航**
   - 直接访问 `/dashboard` - 显示看板
   - 直接访问 `/tasks/xxx` - 显示编辑器或 404
   - 访问 `/` - 重定向到 `/dashboard`

2. **浏览器前进/后退**
   - 从看板 → 编辑器 → 后退 → 前进
   - URL 和页面状态正确

---

## 预期结果

### ✅ 成功标准
1. **路由工作正常**
   - 所有路由可访问
   - 重定向正确

2. **API 通信正常**
   - 获取任务列表成功
   - 创建任务成功
   - 删除任务成功

3. **UI 显示正确**
   - 任务看板布局美观
   - 任务卡片信息完整
   - 进度条显示准确

4. **WebSocket/轮询工作**
   - 进度更新及时
   - 连接断开自动降级

---

## 已知限制

### Phase 3 范围内
- ✅ 任务看板基础功能
- ✅ 任务 CRUD 操作
- ✅ 路由导航
- ✅ WebSocket + 轮询混合
- ⚠️ 编辑器仍使用旧版本（未集成任务系统）

### Phase 4 待实现
- ❌ 编辑器与任务系统集成
- ❌ 多语言处理进度跟踪
- ❌ 批量操作
- ❌ 导出功能集成

---

## 调试技巧

### 1. 查看网络请求
打开浏览器开发者工具 → Network
- 检查 API 请求（`/api/tasks`）
- 检查 WebSocket 连接（`/ws/tasks/{task_id}`）

### 2. 查看控制台
浏览器开发者工具 → Console
- WebSocket 连接日志
- 轮询切换日志
- 错误信息

### 3. 后端日志
查看后端控制台输出：
- API 请求日志
- WebSocket 连接/断开
- 数据库操作

### 4. 数据库检查
```bash
cd backend
sqlite3 localclip.db "SELECT * FROM tasks;"
```

---

## 常见问题

### Q1: 页面空白
**检查**:
- 浏览器控制台是否有错误
- 后端是否启动（http://localhost:8080/docs）
- 前端是否启动（http://localhost:5173）

### Q2: 任务列表不显示
**检查**:
- API 请求是否成功（Network 标签）
- 后端是否返回空数组 `[]`（正常）
- 是否有 CORS 错误

### Q3: 上传失败
**检查**:
- 文件大小是否过大
- 后端 `tasks/` 目录权限
- 网络请求错误信息

### Q4: WebSocket 无法连接
**检查**:
- Vite 代理配置（vite.config.ts）
- 后端 WebSocket 端点（http://localhost:8080/docs）
- 浏览器控制台 WebSocket 错误

---

## 测试通过标准

### 必须通过
- [x] 能访问任务看板
- [x] 能创建新任务
- [x] 能查看任务列表
- [x] 能打开任务编辑器
- [x] 能删除任务

### 可选（功能性）
- [ ] WebSocket 实时更新
- [ ] 轮询降级机制
- [ ] 进度条显示

---

## 下一步

Phase 3 完成后，进入 **Phase 4: 集成现有功能**
- 修改现有处理 API 支持 task_id
- 集成进度推送到 WebSocket
- 实现多语言独立处理
- 完善导出功能
